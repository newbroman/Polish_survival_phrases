<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Polish Survival Guide</title>
    <style>
        :root { --pol-red: #dc143c; --success: #2ecc71; --bg: #f0f2f5; --card: #ffffff; --text: #333; --tile-bg: #dee2e6; }
        @media (prefers-color-scheme: dark) { :root { --bg: #1a1a1a; --card: #2d2d2d; --text: #f0f0f0; --tile-bg: #404040; } }
        
        body { font-family: -apple-system, sans-serif; margin: 0; background: var(--bg); display: flex; flex-direction: column; align-items: center; height: 100vh; color: var(--text); overflow: hidden; }
        .header { background: var(--pol-red); color: white; width: 100%; text-align: center; padding: 6px 0; font-weight: bold; font-size: 0.85rem; flex-shrink: 0; }
        
        .mode-tabs { display: flex; width: 100%; background: var(--card); border-bottom: 1px solid #ddd; flex-shrink: 0; }
        .tab { flex: 1; padding: 8px; text-align: center; font-size: 0.6rem; font-weight: bold; cursor: pointer; opacity: 0.5; }
        .tab.active { opacity: 1; border-bottom: 3px solid var(--pol-red); }

        .quiz-section { width: 94%; max-width: 400px; margin-top: 8px; background: var(--card); padding: 10px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); flex-shrink: 0; box-sizing: border-box; }
        .feedback { height: 18px; font-size: 0.8rem; font-weight: bold; margin-bottom: 4px; text-align: center; }
        .quiz-controls { display: flex; align-items: center; gap: 8px; }
        .speak-btn { background: transparent; border: 2px solid var(--pol-red); color: var(--pol-red); width: 40px; height: 40px; border-radius: 50%; font-size: 1.2rem; cursor: pointer; flex-shrink: 0; }
        
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; flex-grow: 1; }
        .option-btn { background: var(--tile-bg); border: none; padding: 8px; border-radius: 8px; font-size: 0.8rem; font-weight: bold; color: var(--text); display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 45px; }
        .option-btn span.hint { font-size: 0.5rem; opacity: 0.7; font-weight: normal; text-align: center; }

        .map-section { width: 96%; max-width: 450px; margin-top: 8px; flex-grow: 1; overflow-y: auto; padding-bottom: 15px; }
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 4px; }
        .tile { aspect-ratio: 1/1; display: flex; flex-direction: column; align-items: center; justify-content: center; background: var(--tile-bg); border-radius: 6px; cursor: pointer; transition: 0.1s; padding: 2px; }
        .tile .char { font-size: 0.7rem; font-weight: bold; text-align: center; line-height: 1; }
        .tile .sub { font-size: 0.45rem; opacity: 0.7; margin-top: 2px; text-align: center; }
        
        .next-btn { background: #3498db; color: white; width: 100%; padding: 10px; border-radius: 8px; font-size: 0.9rem; border: none; display: none; margin-top: 6px; font-weight: bold; }
    </style>
</head>
<body>

<div class="header" id="dynamic-header">POLSKI GUIDE</div>

<div class="mode-tabs">
    <div id="tab-alpha" class="tab active" onclick="switchMode('alpha')">ALPHA</div>
    <div id="tab-extra" class="tab" onclick="switchMode('extra')">SPECIALS</div>
    <div id="tab-survival" class="tab" onclick="switchMode('survival')">GUIDE</div>
</div>

<div class="quiz-section">
    <div class="feedback" id="feedback"></div>
    <div class="quiz-controls">
        <button class="speak-btn" onclick="speakTarget()">ðŸ”Š</button>
        <div class="options-grid" id="options-grid"></div>
    </div>
    <button id="next-btn" class="next-btn" onclick="startNewRound()">NastÄ™pny â†’</button>
</div>

<div class="map-section">
    <div class="grid" id="mastery-map"></div>
</div>

<script>
    const alphabetData = {
        'A': {h: 'ah', w: 'Auto', e: 'ðŸš—'}, 'B': {h: 'b', w: 'But', e: 'ðŸ‘ž'}, 'C': {h: 'ts', w: 'Cukier', e: 'ðŸ¬'}, 
        'D': {h: 'd', w: 'Dom', e: 'ðŸ '}, 'E': {h: 'eh', w: 'Ekran', e: 'ðŸ“±'}, 'F': {h: 'f', w: 'Farba', e: 'ðŸŽ¨'},
        'G': {h: 'g', w: 'GÃ³ra', e: 'ðŸ”ï¸'}, 'H': {h: 'h', w: 'Herbata', e: 'ðŸµ'}, 'I': {h: 'ee', w: 'ImiÄ™', e: 'ðŸ†”'},
        'J': {h: 'y', w: 'Jajko', e: 'ðŸ¥š'}, 'K': {h: 'k', w: 'Kot', e: 'ðŸ±'}, 'L': {h: 'l', w: 'Lampa', e: 'ðŸ’¡'},
        'M': {h: 'm', w: 'Mama', e: 'ðŸ‘©'}, 'N': {h: 'n', w: 'Noc', e: 'ðŸŒ™'}, 'O': {h: 'oh', w: 'Okno', e: 'ðŸªŸ'},
        'P': {h: 'p', w: 'Pies', e: 'ðŸ¶'}, 'R': {h: 'r', w: 'RÄ™ka', e: 'âœ‹'}, 'S': {h: 's', w: 'Ser', e: 'ðŸ§€'},
        'T': {h: 't', w: 'Tak', e: 'ðŸ‘'}, 'U': {h: 'oo', w: 'Ucho', e: 'ðŸ‘‚'}, 'W': {h: 'v', w: 'Woda', e: 'ðŸ’§'},
        'Y': {h: 'i', w: 'Syn', e: 'ðŸ‘¦'}, 'Z': {h: 'z', w: 'ZÄ…b', e: 'ðŸ¦·'}
    };

    const extraData = {
        'Ä„': {h: 'own', w: 'MÄ…ka', e: 'ðŸŒ¾'}, 'Ä˜': {h: 'en', w: 'GÄ™Å›', e: 'ðŸ¦¢'}, 'Å': {h: 'w', w: 'ÅÃ³dÅº', e: 'â›µ'},
        'Åƒ': {h: 'ny', w: 'KoÅ„', e: 'ðŸŽ'}, 'Ã“': {h: 'oo', w: 'OgrÃ³d', e: 'ðŸŒ³'}, 'Åš': {h: 'sh!', w: 'Åšnieg', e: 'â„ï¸'},
        'Å¹': {h: 'zh!', w: 'Å¹le', e: 'ðŸ‘Ž'}, 'Å»': {h: 'zh', w: 'Å»aba', e: 'ðŸ¸'}, 'Ä†': {h: 'ch!', w: 'Ä†ma', e: 'ðŸ¦‹'}
    };

    // Data from your JSON file
    const phrasesData = [
        { "pl": "CzeÅ›Ä‡", "en": "Hi / Bye" },
        { "pl": "DzieÅ„ dobry", "en": "Good morning" },
        { "pl": "Dobranoc", "en": "Goodnight" },
        { "pl": "Do widzenia", "en": "Goodbye" },
        { "pl": "ProszÄ™", "en": "Please / welcome" },
        { "pl": "DziÄ™kujÄ™", "en": "Thank you" },
        { "pl": "DziÄ™ki", "en": "Thanks" },
        { "pl": "Przepraszam", "en": "Sorry / Excuse me" },
        { "pl": "Nie ma za co", "en": "No problem" },
        { "pl": "Na zdrowie!", "en": "Cheers!" },
        { "pl": "Smacznego!", "en": "Enjoy!" },
        { "pl": "Tak", "en": "Yes" },
        { "pl": "Nie", "en": "No" },
        { "pl": "Nie wiem", "en": "I donâ€™t know" },
        { "pl": "Ile to kosztuje?", "en": "How much?" },
        { "pl": "Rachunek, proszÄ™", "en": "Bill, please" },
        { "pl": "Pomocy!", "en": "Help!" },
        { "pl": "ZgubiÅ‚em siÄ™", "en": "I am lost" }
    ];

    let currentMode = 'alpha'; 
    let mastery = {};
    let currentTarget = null;

    function switchMode(m) {
        currentMode = m;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById('tab-' + m).classList.add('active');
        document.getElementById('dynamic-header').innerText = m === 'survival' ? "SURVIVAL GUIDE" : "POLSKI MASTER";
        initData(); updateMap(); startNewRound();
    }

    function initData() {
        const key = 'pMastery_final_v1_' + currentMode;
        const saved = localStorage.getItem(key);
        mastery = saved ? JSON.parse(saved) : {};
        
        let keys = [];
        if (currentMode === 'alpha') keys = Object.keys(alphabetData);
        else if (currentMode === 'extra') keys = Object.keys(extraData);
        else keys = phrasesData.map(p => p.pl);

        keys.forEach(k => { if (!mastery[k]) mastery[k] = {correct: 0, total: 0}; });
    }

    function speak(text, extra = "") {
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'pl-PL';
        msg.rate = 0.8;
        if (extra) {
            msg.onend = () => {
                const eMsg = new SpeechSynthesisUtterance(extra);
                eMsg.lang = 'pl-PL';
                eMsg.rate = 0.7;
                window.speechSynthesis.speak(eMsg);
            };
        }
        window.speechSynthesis.speak(msg);
    }

    function updateMap() {
        const mapDiv = document.getElementById('mastery-map');
        mapDiv.innerHTML = '';
        
        Object.keys(mastery).forEach(k => {
            const item = mastery[k];
            const tile = document.createElement('div');
            tile.className = 'tile';
            
            if (currentMode === 'alpha' || currentMode === 'extra') {
                const src = currentMode === 'alpha' ? alphabetData[k] : extraData[k];
                tile.innerHTML = `<span class="char">${k}</span><span class="sub">${src.h}</span>`;
                tile.onclick = () => speak(k, "Jak " + src.w);
            } else {
                const src = phrasesData.find(p => p.pl === k);
                tile.innerHTML = `<span class="char">${k}</span><span class="sub">${src.en}</span>`;
                tile.onclick = () => speak(k);
            }

            if (item.total > 0) {
                const p = (item.correct / item.total) * 100;
                tile.style.backgroundColor = `rgb(${Math.min(255, 510 * (1-p/100))}, ${Math.min(255, 510 * (p/100))}, 100)`;
                tile.style.color = 'white';
            }
            mapDiv.appendChild(tile);
        });
    }

    function startNewRound() {
        document.getElementById('feedback').innerText = "";
        document.getElementById('next-btn').style.display = "none";
        const grid = document.getElementById('options-grid');
        grid.innerHTML = "";

        let keys = currentMode === 'alpha' ? Object.keys(alphabetData) : 
                   (currentMode === 'extra' ? Object.keys(extraData) : phrasesData.map(p => p.pl));
        
        currentTarget = keys[Math.floor(Math.random() * keys.length)];
        let choices = keys.sort(() => 0.5 - Math.random()).slice(0, 4);
        if (!choices.includes(currentTarget)) choices[0] = currentTarget;
        
        choices.sort().forEach(c => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            let hint = "";
            if (currentMode === 'alpha') hint = alphabetData[c].h;
            else if (currentMode === 'extra') hint = extraData[c].h;
            else hint = phrasesData.find(p => p.pl === c).en;

            btn.innerHTML = `${c}<span class="hint">${hint}</span>`;
            btn.onclick = () => checkAnswer(c);
            grid.appendChild(btn);
        });
        setTimeout(() => speak(currentTarget), 400);
    }

    function checkAnswer(guess) {
        if (document.getElementById('next-btn').style.display === "block") return;
        mastery[currentTarget].total++;
        if (guess === currentTarget) {
            mastery[currentTarget].correct++;
            document.getElementById('feedback').innerText = "Åšwietnie!";
            document.getElementById('feedback').style.color = "var(--success)";
            document.getElementById('next-btn').style.display = "block";
        } else {
            document.getElementById('feedback').innerText = "SprÃ³buj ponownie!";
            document.getElementById('feedback').style.color = "var(--pol-red)";
        }
        localStorage.setItem('pMastery_final_v1_' + currentMode, JSON.stringify(mastery));
        updateMap();
    }

    function speakTarget() { if (currentTarget) speak(currentTarget); }
    window.onload = () => { initData(); updateMap(); startNewRound(); };
</script>
</body>
</html>
