<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Polish Phrase Master v36.0</title>

    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f0f2f5">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1a1a1a">

    <link rel="icon" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <link rel="stylesheet" href="/src/style.css">
</head>

<body class="practice-mode-active">

    <div id="overlay">
        <h1 style="color:var(--gold);" id="mastery-title">LEVEL MASTERED!</h1>
        <button onclick="advanceLevel()"
            style="padding: 12px 24px; background: var(--pol-red); color: white; border: none; border-radius: 8px; font-weight: bold; font-size:1.1rem; cursor:pointer;"
            id="mastery-btn">Next Level</button>
    </div>

    <div id="hint-overlay" class="modal-overlay">
        <div class="modal-container" style="max-height: 50dvh;">
            <div class="modal-header">
                <h2>ğŸ’¡ Grammar / Context</h2>
                <button class="modal-close" onclick="closeHint()">Ã—</button>
            </div>
            <div class="modal-body">
                <p id="hint-text" style="font-size:1.1rem; line-height:1.5; color:var(--text); margin:0;"></p>
            </div>
        </div>
    </div>

    <div id="help-overlay" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h2>Dashboard & Help</h2>
                <button class="modal-close" onclick="toggleHelp()">Ã—</button>
            </div>
            <div class="modal-body">
                <details open>
                    <summary>ğŸ“Š Your Progress & Badges</summary>
                    <p>
                        <b>Total Mastered:</b> <span id="stat-mastered"
                            style="color:var(--success-green); font-weight:bold;">0</span><br>
                        <b>Total Points:</b> <span id="stat-total-pts">0</span> â­<br>
                        <b>Best Streak:</b> <span id="stat-best-streak">0</span> ğŸ”¥
                    </p>
                    <p><b>Badges Earned:</b></p>
                    <div id="stat-badges"><span style="color:#888; font-size:0.75rem;">Play more to earn badges!</span>
                    </div>
                </details>

                <details>
                    <summary>ğŸ¯ Spaced Repetition (SRS) & Level R</summary>
                    <p><b>True Spaced Repetition:</b> Words you master are now scheduled for review at optimal intervals
                        (1 day, 3 days, 7 days, etc.) so you never forget them.</p>
                    <p><b>Level R (Daily Due):</b> This is your most important level! It automatically fills with words
                        that you made a mistake on recently, AND any mastered words that are statistically due for a
                        review today.</p>
                    <p><b>Mastery Counters:</b> Every time you fully master a level and choose to "Repeat" it, your
                        completion counter (ğŸ”„x1) goes up!</p>
                </details>

                <details>
                    <summary>ğŸŒ Browser Compatibility</summary>
                    <ul>
                        <li><b>Apple / iOS:</b> Please use <b>Safari</b>. Other browsers block the microphone and
                            text-to-speech due to Apple's security rules.</li>
                        <li><b>Android:</b> Please use <b>Google Chrome</b> for the best native Voice Recognition
                            support.</li>
                        <li><i>Note:</i> You must grant microphone permissions when prompted.</li>
                    </ul>
                </details>

                <details>
                    <summary>âš™ï¸ Installing High-Quality Voices</summary>
                    <p>For natural sounding Polish, you must download the native voices to your device OS:</p>
                    <div style="margin-top:8px;">
                        <b>ğŸ Apple (iPhone/iPad):</b>
                        <ol style="margin-top:4px; padding-left:20px;">
                            <li>Go to <b>Settings > Accessibility > Spoken Content</b>.</li>
                            <li>Tap <b>Voices</b>, then find <b>Polish</b>.</li>
                            <li>Download and select <b>Zosia (Enhanced or Premium)</b> or <b>Krzysztof</b>.</li>
                            <li><i>Crucial:</i> Make sure your phone's physical "Silent/Ring" switch is set to Ring!
                            </li>
                        </ol>
                        <div style="margin-top: 15px;">
                            <b>ğŸ¤– Android:</b>
                            <ol style="margin-top:4px; padding-left:20px;">
                                <li>Go to <b>Settings > General Management</b> (or System).</li>
                                <li>Tap <b>Text-to-speech output</b>.</li>
                                <li>Ensure <b>Speech Services by Google</b> is the preferred engine.</li>
                                <li>Tap the gear icon âš™ï¸ > <b>Install voice data</b> > <b>Polish</b>.</li>
                            </ol>
                        </div>
                </details>

                <details>
                    <summary>ğŸ¤ Voice Recognition & Controls</summary>
                    <p>Tap <b>Speak (ğŸ¤)</b> in the footer to practice pronunciation! <br>
                        If the question is English, say the Polish translation. If you swapped it, say the English!</p>
                    <p><b>ğŸ§  Hard Mode:</b> Hides the written text entirely so you rely purely on listening. You can
                        trigger this mode after mastering any level.</p>
                </details>

                <details>
                    <summary>ğŸ® How to Play &amp; Scoring</summary>
                    <p><b>Phrases tab:</b> Browse all phrases for the selected level. Tap any phrase card to hear it spoken aloud.</p>
                    <p><b>Study tab:</b> Flip through flashcards at your own pace. Swipe left/right or use the arrows. Tap ï¿½ï¿½ to hear the phrase.</p>
                    <p><b>Training tab:</b> Answer questions by tapping the correct tile or speaking your answer. The game tracks your accuracy using Spaced Repetition (SRS).</p>
                    <p>
                        <b>Points:</b> +10 for fast correct. +6 if over 4 seconds. -5 for mistakes.<br>
                        <b>Timer (12s):</b> Taking longer than 12 seconds counts as distracted â€” 0 points and streak lost!<br>
                        <b>Daily Goal:</b> Hit 1000 points (~15 mins) to grow your ğŸ”¥ streak. Missing a day resets it.<br>
                        <b>Win Streaks:</b> Correct answers in a row raise the audio pitch and trigger confetti at 5, 25, 50 and 70!
                    </p>
                </details>

                <details>
                    <summary>ğŸ“– Phrase Book</summary>
                    <p>The <b>Phrases tab</b> is your personal phrasebook. Use the <b>search bar</b> to look up any Polish or English word across all levels instantly.</p>
                    <p>If a phrase isn't found, you'll be offered a <b>Translate</b> button. Tap it to automatically translate the word and add it to <b>Level C</b> â€” your personal custom list.</p>
                    <p><b>Level C</b> works like any other level: practice it in Training, study it as flashcards, and export it from âš™ï¸ Settings to save it permanently as a file.</p>
                    <p>You can also tap the â­ star icon on any flashcard or training card to instantly save a phrase to Level C.</p>
                </details>

                <div style="text-align:center; font-size:0.75rem; color:#888; margin-top:20px;">Polish Phrase Master
                    v37.0</div>
            </div>
        </div>
    </div>

    <div id="settings-overlay" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h2>App Settings</h2>
                <button class="modal-close" onclick="toggleSettings()">Ã—</button>
            </div>
            <div class="modal-body">

                <!-- Settings now focuses exclusively on options and data management -->

                <div class="settings-section">
                    <h3>âš™ï¸ Options</h3>
                    <div class="setting-row">
                        <span class="setting-label" id="lbl-ui-lang-label">UI Language</span>
                        <button class="settings-btn" style="width:auto; margin:0; padding:6px 15px;"
                            onclick="toggleUILang()" id="lbl-ui-lang">EN</button>
                    </div>
                    <button class="settings-btn" onclick="openHandsFree()"
                        style="border-color:var(--pol-red); color:var(--pol-red);" id="lbl-hf">
                        ğŸ§ Start Hands-Free Mode
                    </button>
                </div>

                <div class="settings-section">
                    <h3>ğŸ’¾ Data Management</h3>
                    <div style="display:flex; gap:10px;">
                        <button class="settings-btn" onclick="downloadProgress()" id="btn-save">ğŸ’¾ Save</button>
                        <button class="settings-btn" id="btn-load"
                            onclick="document.getElementById('file-input').click()">ğŸ“‚
                            Load</button>
                    </div>

                    <button class="settings-btn" id="btn-export-c" onclick="exportCustomLevel()"
                        style="border-color:var(--pol-red); color:var(--pol-red); margin-top:10px;">
                        ğŸ“¤ Export Sandbox (Lvl C)
                    </button>

                    <button class="settings-btn danger" id="btn-reset" onclick="resetEverything()"
                        style="margin-top:10px;">âš ï¸ Reset
                        App Data</button>
                </div>

            </div>
        </div>
    </div>

    <div id="hf-overlay">
        <div class="hf-progress-bar" id="hf-bar"></div>
        <div class="hf-header">
            <div style="font-size:0.8rem; color:#666;" id="hf-level-indicator">Level</div>
            <button class="hf-close" onclick="closeHandsFree()">Ã—</button>
        </div>
        <div class="hf-content-area" id="hf-active-view">
            <div style="color:#888; font-weight:bold; margin-bottom:10px;" id="hf-counter">1 / X</div>
            <div id="hf-emoji" style="font-size: 3.5rem; margin-bottom: 15px; display: flex; justify-content: center;">â³
            </div>
            <div class="hf-big-text" id="hf-pl">Ready...</div>
            <div class="hf-sub-text" id="hf-en">Get set...</div>
            <div class="pause-selector">
                <span>Pause:</span>
                <div class="pause-option" onclick="setPauseDuration(1)">1s</div>
                <div class="pause-option active" onclick="setPauseDuration(3)">3s</div>
                <div class="pause-option" onclick="setPauseDuration(5)">5s</div>
            </div>
        </div>
        <div class="hf-controls" id="hf-controls-active">
            <button class="hf-control-btn" id="hf-pp-btn" onclick="togglePlayPauseHF()">â¸ Pause</button>
            <button class="hf-control-btn" onclick="skipPhraseHF()">Next â­</button>
        </div>
    </div>
    <div class="header">
        <div class="points-banner" id="points-display">â­ Points: 0 | Goal: 0 / 1000 | ğŸ”¥ Daily: 0 | ğŸ¯ Correct: 0</div>
    </div>

    <div class="navigation-row"
        style="display: flex; align-items: stretch; justify-content: center; width: 100%; border-bottom: 2px solid #ddd; background: var(--card);">
        <button class="nav-icon-btn" id="main-help-btn" onclick="toggleHelp()"
            style="width: 45px; flex-shrink: 0; background: none; border: none; border-right: 1px solid #ddd; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--text);">â“</button>

        <div class="mode-tabs" style="border-bottom: none; flex: 1; display: flex;">
            <div id="tab-mastered" class="tab" onclick="switchMode('mastered')" style="flex: 1;">
                <span id="lbl-tab-banked">PHRASES</span> <span id="banked-count"></span>
            </div>
            <div id="tab-study" class="tab" onclick="switchMode('study')" style="flex: 1;">
                <span id="lbl-tab-study">STUDY</span>
            </div>
            <div id="tab-learning" class="tab" onclick="switchMode('learning')" style="flex: 1;">
                <span id="lbl-tab-practice">TRAINING</span> <span id="learning-count"></span>
            </div>
        </div>

        <button class="nav-icon-btn" onclick="toggleSettings()"
            style="width: 45px; flex-shrink: 0; background: none; border: none; border-left: 1px solid #ddd; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--text);">âš™ï¸</button>
    </div>

    <div class="progress-wrapper" id="prog-wrapper">
        <div class="progress-container">
            <div id="progress-bar"></div>
        </div>
    </div>

    <div class="quiz-header" id="quiz-ui">
        <div style="display:flex; justify-content:space-between; width:100%; max-width:380px; align-items:center;">
            <button class="search-trigger-btn" id="header-save-btn" onclick="saveCurrentToCustom()"
                style="width:36px; height:36px; padding:0; display:flex; align-items:center; justify-content:center; font-size:1.2rem; cursor:pointer; background:transparent; border:none;"
                title="Save to Sandbox">â­</button>
            <div id="q-text" class="q-text">Ready?</div>

            <button class="search-trigger-btn" onclick="toggleContentSwap()"
                style="width:36px; height:36px; padding:0; display:flex; align-items:center; justify-content:center; font-size:1.2rem; cursor:pointer;"
                title="Swap Language">ğŸ”„</button>
        </div>

        <div id="feedback" class="feedback"></div>
        <div class="timer-wrapper">
            <div id="timer-bar"></div>
        </div>
    </div>

    <div class="map-section" id="game-area" style="position: relative;">
        <div id="pause-overlay">
            <div>â¸ï¸</div>
            <div style="font-size: 1.5rem; letter-spacing: 2px;">PAUSED</div>
        </div>
        <div id="phrases-header"
            style="display: none; width: 100%; max-width: 380px; margin-bottom: 15px; flex-direction: column; gap: 10px;">
            <div class="controls-row" style="width: 100%; max-width: 100%; margin: 0;">
                <div style="display:flex; justify-content:center; align-items:center;">
                    <div class="custom-dropdown" id="lvl-dropdown" style="width:100%;">
                        <div class="main-dropdown-trigger" id="lvl-current" onclick="toggleDropdown(event)">
                            Loading levels...
                        </div>
                        <div class="dropdown-menu" id="lvl-menu"></div>
                    </div>
                </div>
            </div>

            <input type="text" id="banked-search" class="search-box" placeholder="Search dictionary & translate..."
                style="width: 100%; box-sizing: border-box;" oninput="handleSearch(this.value, 'banked')">
        </div>
        <div id="mastery-map" class="grid" style="display: none;"></div>
        <div id="search-results-list" style="display: none;"></div>

        <div id="study-view">
            <div class="flashcard" id="study-flashcard">

                <button class="search-trigger-btn" onclick="toggleContentSwap()"
                    style="position:absolute; top:15px; right:15px; width:36px; height:36px; border-radius:18px; background:var(--bg); border:1px solid #ddd; padding:0; display:flex; align-items:center; justify-content:center; font-size:1.2rem; cursor:pointer;"
                    title="Swap Language">ğŸ”„</button>
                <button id="fc-hint-btn" onclick="toggleStudyNotes()"
                    style="position:absolute; top:60px; right:15px; background:none; border:none; font-size:1.5rem; cursor:pointer; display:none; padding:0; line-height:1;"
                    title="Toggle Grammar Notes">ğŸ’¡</button>
                <button id="study-save-btn" onclick="saveCurrentToCustom()"
                    style="position:absolute; top:15px; left:15px; background:none; border:none; font-size:1.5rem; cursor:pointer; padding:0; line-height:1;"
                    title="Save to Sandbox">â­</button>

                <div class="fc-pl" id="fc-pl">Polish</div>
                <div class="fc-en" id="fc-en">English</div>
                <div id="fc-notes-container"
                    style="display:none; font-size:0.95rem; color:#666; margin-top:20px; line-height:1.4; text-align:center; padding-top:10px; border-top:1px dashed #ccc;">
                </div>
                <button class="fc-audio-btn" onclick="playStudyAudio(event)">ğŸ”Š</button>
            </div>
            <div class="fc-controls">
                <button class="fc-btn" onclick="prevStudyCard()">â—€</button>
                <span class="fc-counter" id="fc-counter">1 / 10</span>
                <button class="fc-btn" onclick="nextStudyCard()">â–¶</button>
            </div>
        </div>
    </div>

    <div class="action-footer">
        <button class="action-btn" id="footer-listen-btn" onclick="handleSpeakerTap()"
            style="background:var(--success-green); color:white; border-color:var(--success-green); flex: 2; padding: 0 5px;"
            title="Listen / Slow Down">
            <span class="action-icon">ğŸ”Š</span>
            <span id="lbl-btn-listen" style="font-size: 0.75rem;">Listen: Tap (1x) | 2 Taps (0.5x) | 3 Taps
                (0.25x)</span>
        </button>
        <button class="action-btn" onclick="togglePauseAudio()" style="flex: 0.5; padding: 0;" title="Pause/Resume">
            <span class="action-icon" id="pause-icon" style="margin:0;">â¸ï¸</span>
        </button>
        <button class="action-btn" id="mic-btn" onclick="toggleMic()" style="flex: 1;">
            <span class="action-icon">ğŸ¤</span>
            <span id="lbl-btn-speak">Speak</span>
        </button>
        <input type="file" id="file-input" style="display:none" onchange="importProgress(event)">
    </div>

    <script type="module" src="/src/main.js"></script>
</body>

</html>